﻿﻿<!DOCTYPE html>
<html lang="pt-BR">
<head><meta charset="UTF-8"><title>Desafio 4: Tabela</title><link rel="stylesheet" href="style.css"></head>
<body>
    <div class="container">
        <h1>Tabela do Caos</h1>
        
        <div class="info-box">
            <h4>🎯 Objetivo: Manipulação de Tabelas e Hover</h4>
            <p>Encontre um registro específico (ex: "Wonder Woman") e clique em excluir. O botão só aparece quando o mouse está sobre a linha (Hover).</p>
            <small>Dica: Use laços para percorrer as <code>&lt;tr&gt;</code> e Actions API para simular o movimento do mouse.</small>
        </div>

        <table class="chaos-table"><thead><tr><th>ID</th><th>Nome</th><th>Ação</th></tr></thead><tbody></tbody></table>
        <br><a href="dashboard.html">Voltar ao Dashboard</a>
    </div>

    <!-- Estrutura da Modal -->
    <div id="custom-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="modal-title">Título</h3>
            <p id="modal-msg">Mensagem</p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        // Proteção de Rota
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'index.html';
        }

        document.addEventListener("DOMContentLoaded", loadHeroes);
        async function loadHeroes() {
            const tbody = document.querySelector('.chaos-table tbody');
            tbody.innerHTML = '<tr><td colspan="3">Carregando...</td></tr>';
            try {
                const response = await fetch('http://localhost:3000/api/heroes');
                const heroes = await response.json();
                tbody.innerHTML = '';
                heroes.forEach(hero => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${hero.id}</td><td>${hero.alter_ego} (${hero.name})</td><td><button class="delete-btn" onclick="deleteHero(${hero.id})">Excluir</button></td>`;
                    tbody.appendChild(tr);
                });
            } catch (e) { console.error(e); }
        }
        async function deleteHero(id) {
            if(confirm("Tem certeza que deseja excluir este herói do Banco de Dados?")) {
                await fetch(`http://localhost:3000/api/heroes/${id}`, { method: 'DELETE' });
                showModal("Sucesso", "Excluído com sucesso!", true);
                loadHeroes();
            }
        }

        function showModal(title, message, isSuccess) {
            const titleElem = document.getElementById('modal-title');
            titleElem.innerText = title;
            titleElem.style.color = isSuccess ? '#27ae60' : '#e74c3c';
            document.getElementById('modal-msg').innerText = message;
            document.getElementById('custom-modal').style.display = 'block';
        }
        function closeModal() { document.getElementById('custom-modal').style.display = 'none'; }
        window.onclick = function(event) { if (event.target == document.getElementById('custom-modal')) closeModal(); }
    </script>
</body></html>
